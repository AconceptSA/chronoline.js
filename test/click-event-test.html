<!doctype html>
<html>
<head>
	<meta charset="utf-8"/>
		<title>Chronoline - event test</title>
		<link rel="stylesheet" href="qunit.css"/>
    <link rel="jquery.qtip.min.css"/>
		<link rel="stylesheet" href="../chronoline/chronoline.css"/>
	  
	  <script src="jquery.min.js"></script>
	  <script src="../chronoline/raphael-min.js"></script>
	  <script src="qunit.js"></script>
    <script src="jquery.qtip.min.js"></script>
	  <script src="../chronoline/chronoline.js"></script>
  <script>
  
  
      
      var oneEvent = [
      {dates: [new Date(2015, 2, 31)], title: "2011 Season Opener", section: 0}]

      var events = [
      {dates: [new Date(2011, 2, 31)], title: "2011 Season Opener", section: 0},
      {dates: [new Date(2012, 1, 29)], title: "Spring Training Begins", section: 2},
      {dates: [new Date(2012, 3, 5)], title: "Atlanta Braves @ New York Mets Game 1", section: 1},
      {dates: [new Date(2012, 3, 7)], title: "Atlanta Braves @ New York Mets Game 2", section: 1},
      {dates: [new Date(2012, 3, 8)], title: "Atlanta Braves @ New York Mets Game 3", section: 1},
      {dates: [new Date(2012, 3, 9), new Date(2012, 3, 11)], title: "Atlanta Braves @ Houston Astros", section: 1},
      {dates: [new Date(2012, 3, 13), new Date(2012, 3, 15)], title: "Milwaukee Brewers @ Atlanta Braves", section: 1},
      {dates: [new Date(2012, 3, 9), new Date(2012, 3, 11)], title: "Boston Red Sox @ Toronto Blue Jays", section: 1},
      {dates: [new Date(2012, 3, 13), new Date(2012, 3, 15)], title: "Baltimore Orioles @ Toronto Blue Jays", section: 1},
      {dates: [new Date(2012, 3, 17), new Date(2012, 3, 19)], title: "Tampa Bay Rays @ Toronto Blue Jays", section: 1},
      {dates: [new Date(2012, 3, 20), new Date(2012, 3, 23)], title: "Toronto Blue Jays @ Kansas City Royals", section: 1},
      {dates: [new Date(2012, 3, 5)], title: "Opening Day for 12 Teams", section: 1},
      {dates: [new Date(2012, 2, 28)], title: "Seattle Mariners v. Oakland A's", section: 1, description: "Played in Japan!"},
      {dates: [new Date(2012, 4, 18), new Date(2012, 5, 24)], title: "Interleague Play", section: 1},
      {dates: [new Date(2012, 5, 10)], title: "All-Star Game", section: 1},
      {dates: [new Date(2012, 9, 24)], title: "World Series Begins", section: 3}
      ];

      var sections = [
      {dates: [new Date(2011, 2, 31), new Date(2011, 9, 28)], title: "2011 MLB Season", section: 0, attrs: {fill: "#d4e3fd"}},
      {dates: [new Date(2012, 2, 28), new Date(2012, 9, 3)], title: "2012 MLB Regular Season", section: 1, attrs: {fill: "#d4e3fd"}},
      {dates: [new Date(2012, 1, 29), new Date(2012, 3, 4)], title: "Spring Training", section: 2, attrs: {fill: "#eaf0fa"}},
      {dates: [new Date(2012, 9, 4), new Date(2012, 9, 31)], title: "2012 MLB Playoffs", section: 3, attrs: {fill: "#eaf0fa"}}
      ];


      $(document).ready(function(){

        test("single event click test", 2, function (assert) {
            //initilize the timeline with 4 sections and one event
            var timeline1 = new Chronoline(document.getElementById("target1"), oneEvent,
            {
                defaultStartDate: new Date(2012,2,20),
                sections: sections,
                eventClick: function(data){
                    assert.equal(data,oneEvent[0],'single click test, event data equals event data.');
                },
                eventDblClick: function (data) {
                    assert.equal(data, oneEvent[0], 'double click, event data equals event data.');
                }
            });

                var evObj = document.createEvent('MouseEvents');
                evObj.initEvent('click', true, false);
                $("#target1").find(".chronoline-event").each(function () {
                    this.dispatchEvent(evObj);
                });
                var evObjDbl = document.createEvent('MouseEvents');
                evObjDbl.initEvent('dblclick', true, false);
                $("#target1").find(".chronoline-event").each(function () {
                    this.dispatchEvent(evObjDbl);
                });
            });
            test("multiple event test, asset all the events are only called once.", events.length * 2, function (assert) {
                var clickTestEvents = events.slice(0);
                var dblClickTestEvents = events.slice(0);
                var timeline2 = new Chronoline(document.getElementById("target2"), events,
                {
                    defaultStartDate: new Date(2012, 3, 1),
                    sections: sections,
                    eventClick: function(data){
                        for (var i = 0, len = clickTestEvents.length; i < len; i++) {
                            // assert that all the events are only called once
                            if (data === clickTestEvents[i]) {
                                assert.equal(data, clickTestEvents[i], 'Single click event data equals event data.');
                                clickTestEvents[i] = null;
                            }
                        }
                    },
                    eventDblClick: function (data) {
                        for (var i = 0, len = dblClickTestEvents.length; i < len; i++) {
                            // assert that all the events are only called once
                            if (data === dblClickTestEvents[i]) {
                                assert.equal(data, dblClickTestEvents[i], 'Double click event data equals event data.');
                                dblClickTestEvents[i] = null;
                            }
                        }
                    }
                });
                //click all the events in the second timeline
                var evObj = document.createEvent('MouseEvents');
                evObj.initEvent('click', true, false);
                $('#target2').find(".chronoline-event").each(function () {
                    this.dispatchEvent(evObj);
                });
                var dblEvObj = document.createEvent('MouseEvents');
                dblEvObj.initEvent('dblclick', true, false);
                $('#target2').find('.chronoline-event').each(function () {
                    this.dispatchEvent(dblEvObj);
                });
          });
          test("sections click test", sections.length * 4, function (assert) {
              //prep section array fro section click test
              var clickTestSections = sections.slice(0);
              var dblClickTestSections = sections.slice(0);
              //initilize the timeline with 4 sections and one event
              var timeline3 = new Chronoline(document.getElementById('target3'), oneEvent,
              {
                  defaultStartDate: new Date(2012, 2, 20),
                  sections: sections,
                  sectionClick: function (data, date) {
                      for (var i = 0, len = clickTestSections.length; i < len; i++) {
                          // assert that all the sections are only called once
                          if (data === clickTestSections[i]) {
                              assert.equal(data, clickTestSections[i], 'Single click event data equals event data.');
                              assert.equal(date.getTime(), data.dates[0].getTime(), 'clicked date should be same as start date.')
                              clickTestSections[i] = null;
                          }
                      }
                  },
                  sectionDblClick: function (data, date) {
                      for (var i = 0, len = dblClickTestSections.length; i < len; i++) {
                          // assert that all the sections are only called once
                          if (data === dblClickTestSections[i]) {
                              assert.equal(data, dblClickTestSections[i], 'Double click event data equals event data.');
                              assert.equal(date.getTime(), data.dates[0].getTime(), 'double clicked date should be same as start date.')
                              dblClickTestSections[i] = null;
                          }
                      }
                  },
              });

              //for each section, dispach a click event into the top left corner, shoul return start date.
              $("#target3").find(".chronoline-section").each(function () {
                  var evt = mouseEvent("click", this.x.baseVal.value, 4, this.x.baseVal.value, 4);
                  dispatchEvent(this, evt);
              });
              //repeat for double click
              $("#target3").find(".chronoline-section").each(function () {
                  var evt = mouseEvent("dblclick", this.x.baseVal.value, 4, this.x.baseVal.value, 4);
                  dispatchEvent(this, evt);
              });
          });
      });
      
      //create a mouse event with type and x y cordinates
      //supports several browsers
      function mouseEvent(type, sx, sy, cx, cy) {
          var evt;
          var e = {
              bubbles: true,
              cancelable: (type != "mousemove"),
              view: window,
              detail: 0,
              screenX: sx,
              screenY: sy,
              clientX: cx,
              clientY: cy,
              ctrlKey: false,
              altKey: false,
              shiftKey: false,
              metaKey: false,
              button: 0,
              relatedTarget: undefined
          };
          if (typeof (document.createEvent) == "function") {
              evt = document.createEvent("MouseEvents");
              evt.initMouseEvent(type,
                e.bubbles, e.cancelable, e.view, e.detail,
                e.screenX, e.screenY, e.clientX, e.clientY,
                e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,
                e.button, document.body.parentNode);
          } else if (document.createEventObject) {
              evt = document.createEventObject();
              for (prop in e) {
                  evt[prop] = e[prop];
              }
              evt.button = { 0: 1, 1: 4, 2: 2 }[evt.button] || evt.button;
          }
          return evt;
      }
      //dispach mouse event
      // supports multiple browsers
      function dispatchEvent(el, evt) {
          if (el.dispatchEvent) {
              el.dispatchEvent(evt);
          } else if (el.fireEvent) {
              el.fireEvent('on' + type, evt);
          }
          return evt;
      }
    
  </script>
</head>
<body>

<div id="qunit"></div>
<div>Test timline, one event.</div>
 <div id="target1"></div> 
 <div>Test timline, multiple events.</div>
 <div id="target2"></div> 
    <div>Test timline, section click</div>
    <div id="target3"></div> 
</body>
</html>